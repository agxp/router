<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CloudFlix</title>
</head>
<h1>Welcome to cloudflix</h1>
    Choose file...
    <input type="file" id="selector">
    <input type="text" id="title">
    <label for="title">Title</label>
    <input type="text" id="description">
    <label for="description">Description</label>

    <button type="button" onclick="upload()">Upload</button>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</html>
<script>
    function upload() {
        [$('#selector')[0].files].forEach(fileObj => {
            var file = fileObj[0]
            // Retrieve a URL from our server.
            retrieveNewURL(file)
        })
    }
    function retrieveNewURL(file) {
		var filename = file.name;
		var title = document.getElementById('title').value;
        var description = document.getElementById('description').value;

        if (title.length === 0) {
		    console.log("must have title");
            return;
        }
        if (description.length === 0) {
            console.log("must have description");
            return;
        }
        axios.post(`/uploadFile`, {
            filename,
            title,
            description
        }).then( function(res) {
            console.log(res)
            console.log(file)

            var config = {
                onUploadProgress: function(progressEvent) {
                    var percentCompleted = Math.round( (progressEvent.loaded * 100) / progressEvent.total );
                }
            };

            var id = res.data['id'];

            axios.put(res.data['presigned_url'], file, config)
                    .then(function (res) {
                        console.log("finished upload of" + file.name);
                        axios.post(`/uploadFinish`, {
                            id
                        }).then(function(res) {
                            console.log("server accepted UploadFinish")
                        })
                    })
                    .catch(function (err) {
                        console.log(err.message);
                    });

        })
    }
    function uploadFile(file, url) {

    }
</script>
